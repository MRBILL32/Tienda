<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin - Tienda Kokiri</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/admin-style.css">
    <style>
        .seccion { display: none; }
        .seccion.active { display: block; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="text-center">Panel del Empleado</h2>

    <!-- BOTONES DE SECCIÓN -->
    <div class="text-center my-4">
        <div class="d-inline-block p-3 rounded shadow-sm"
             style="background-color: #f5faff; border: 1px solid #c8e1f0;">

            <a th:href="@{/empleado/inicio(seccion='usuarios')}"
               class="btn btn-outline-primary mx-2"
               th:classappend="${seccionActiva == 'usuarios'} ? ' active'">Usuarios</a>

            <a th:href="@{/empleado/inicio(seccion='productos')}"
               class="btn btn-outline-success mx-2"
               th:classappend="${seccionActiva == 'productos'} ? ' active'">Productos</a>

			<a th:href="@{/empleado/inicio(seccion='detallePedidos')}"
			   class="btn btn-outline-warning mx-2"
			   th:classappend="${seccionActiva == 'detallePedidos'} ? ' active'">Pedidos</a>
			
			<a href="/logout" class="btn btn-outline-danger mx-1">Cerrar Sesión</a>
			   
        </div>
    </div>

    <!-- USUARIOS -->
    <div id="usuarios" class="seccion" th:classappend="${seccionActiva == 'usuarios'} ? ' active'">
        <h4>Usuarios Registrados (Total: <span th:text="${totalUsuarios}"></span>)</h4>

        <!-- ALERTAS -->
        <div th:if="${aprobar}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${aprobar}"></span>
        </div>
        <div th:if="${rechazar}" class="alert alert-warning alert-dismissible fade show" role="alert">
            <span th:text="${rechazar}"></span>
        </div>
        <div th:if="${eliminar}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${eliminar}"></span>
        </div>
		<div th:if="${registro}" class="alert alert-success alert-dismissible fade show" role="alert">
		    <span th:text="${registro}"></span>
		</div>
		
		

        <!-- BUSCADOR -->
        <form method="get" th:action="@{/empleado/inicio}">
            <input type="hidden" name="seccion" value="usuarios"/>
            <div class="input-group mb-3">
                <input type="text" name="filtro" th:value="${filtro}" class="form-control"
                       placeholder="Buscar por nombre, apellido o rol...">
                <button type="submit" class="btn btn-primary">Buscar</button>
            </div>
        </form>

        <div th:if="${usuarios != null and usuarios.size() == 0}" class="text-center text-danger mb-2">
            No se encontraron resultados.
        </div>

        <!-- TABLA -->
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>ID</th><th>DNI</th><th>Nombre y Apellido</th><th>Usuario</th>
                <th>Rol</th><th>Correo</th><th>Estado</th><th>Acción</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="u : ${usuarios}">
                <td th:text="${u.idUser}"></td>
                <td th:text="${u.dni}"></td>
                <td th:text="${u.nombres + ' ' + u.apellidos}"></td>
                <td th:text="${u.login}"></td>
                <td th:text="${u.rol.tipoRol}"></td>
                <td th:text="${u.correo}"></td>
                <td th:text="${u.estado}"></td>
                <td>
                    <div th:if="${u.estado == 'Aprobado'}">
                        <form th:if="${u.idUser != idActual}" th:action="@{/admin/eliminarUsuario}" method="post"
                              style="display:inline;">
                            <input type="hidden" name="id" th:value="${u.idUser}"/>
                            <button type="submit" class="btn btn-sm btn-danger"
                                    onclick="return confirm('¿Estás seguro de eliminar este usuario?')">Eliminar</button>
                        </form>
                        <span th:if="${u.idUser == idActual}" class="text-muted">Tu Usuario</span>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- PAGINACIÓN -->
        <nav th:if="${totalPaginas > 1}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${paginaActual == 1} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{'/empleado/inicio'(seccion='usuarios', page=${paginaActual - 1}, filtro=${filtro})}">Anterior</a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPaginas)}"
                    th:classappend="${i == paginaActual} ? 'active'">
                    <a class="page-link"
                       th:href="@{'/empleado/inicio'(seccion='usuarios', page=${i}, filtro=${filtro})}"
                       th:text="${i}">1</a>
                </li>
                <li class="page-item" th:classappend="${paginaActual == totalPaginas} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{'/empleado/inicio'(seccion='usuarios', page=${paginaActual + 1}, filtro=${filtro})}">Siguiente</a>
                </li>
            </ul>
        </nav>
    </div>

</body>
</html>

